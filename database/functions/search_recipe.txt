CREATE OR REPLACE FUNCTION "search_recipe"(SEARCH_TERM IN VARCHAR2) RETURN SYS_REFCURSOR
AS
RECIPES_CR SYS_REFCURSOR;
TOTAL_COUNT NUMBER(10);
STATUS VARCHAR2(10);
BEGIN
	OPEN RECIPES_CR FOR 
			SELECT RECIPE_ID, TITLE, (SELECT (FIRST_NAME||' '||LAST_NAME) AS NAME FROM USERS WHERE USER_ID = R.USER_ID) as PUBLISHER_NAME,TO_CHAR(CREATION_DATE,'DD/MON/YY') CREATION_DATE , COOKING_INSTRUCTION ,AVERAGE_RATING(RECIPE_ID) as RATING
		FROM RECIPES R
		WHERE LOWER(TITLE) LIKE '%'||LOWER(SEARCH_TERM)||'%'
		ORDER BY TITLE;
	RETURN RECIPES_CR;
END;