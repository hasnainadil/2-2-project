CREATE OR REPLACE PROCEDURE "ALL_PROFILE"(row_num in NUMBER,SEARCH IN VARCHAR2,TOTAL_COUNT OUT NUMBER,STATUS OUT VARCHAR2,PROFILE_CR OUT SYS_REFCURSOR) AS
BEGIN
	 if row_num = 0 then 
OPEN PROFILE_CR FOR 
			SELECT USER_ID, (FIRST_NAME||' '||LAST_NAME) AS NAME, TO_CHAR(REGISTRATION_DATE,'DD/MON/YY') as REGISTRATION_DATE,	GET_FOLLOWER_NUM(USER_ID) as FOLLOWERS , (SELECT PROFILE_PICTURE FROM USERS WHERE USER_ID = u.USER_ID) as PROFILE_PICTURE
		FROM USERS u
		WHERE LOWER(FIRST_NAME||' '||LAST_NAME) LIKE '%'||LOWER(SEARCH)||'%'
		ORDER BY GET_FOLLOWER_NUM(USER_ID) DESC;
		ELSE
		OPEN PROFILE_CR FOR
		SELECT* FROM( 
			SELECT USER_ID, (FIRST_NAME||' '||LAST_NAME) AS NAME, TO_CHAR(REGISTRATION_DATE,'DD/MON/YY') as REGISTRATION_DATE,GET_FOLLOWER_NUM(USER_ID) as FOLLOWERS , (SELECT PROFILE_PICTURE FROM USERS WHERE USER_ID = u.USER_ID) as PROFILE_PICTURE
		FROM USERS u
		WHERE LOWER(FIRST_NAME||' '||LAST_NAME) LIKE '%'||LOWER(SEARCH)||'%'
		ORDER BY GET_FOLLOWER_NUM(USER_ID) DESC)
		WHERE ROWNUM <= row_num;
	 end if;
	
		
		SELECT COUNT(*) INTO TOTAL_COUNT FROM USERS WHERE LOWER(FIRST_NAME||' '||LAST_NAME) LIKE '%'||LOWER(SEARCH)||'%';
	STATUS := 'SUCCESSFUL';
EXCEPTION
	WHEN NO_DATA_FOUND THEN
	STATUS := 'NO DATA FOUND';
	WHEN OTHERS THEN
	STATUS := 'UNKNOWN ERROR';
END;