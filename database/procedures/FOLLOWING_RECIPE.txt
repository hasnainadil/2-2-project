CREATE OR REPLACE PROCEDURE "FOLLOWING_RECIPE" (ID IN NUMBER,RECIPES_CR OUT SYS_REFCURSOR,STATUS OUT VARCHAR2) AS
BEGIN
	-- routine body goes here, e.g.
	-- DBMS_OUTPUT.PUT_LINE('Navicat for Oracle');
	OPEN RECIPES_CR FOR 
			SELECT RECIPE_ID, TITLE, (SELECT (FIRST_NAME||' '||LAST_NAME) AS NAME FROM USERS WHERE USER_ID = R.USER_ID) as PUBLISHER_NAME,TO_CHAR(CREATION_DATE,'DD/MON/YY') CREATION_DATE , COOKING_INSTRUCTION ,AVERAGE_RATING(RECIPE_ID) as RATING,(SELECT IMAGE FROM MEDIA WHERE RECIPE_ID = R.RECIPE_ID)AS IMAGE
		FROM RECIPES R
		WHERE R.RECIPE_ID IN (SELECT RECIPE_ID FROM RECIPES WHERE USER_ID IN (SELECT FOLLOWING_ID FROM FOLLOW WHERE USER_ID = ID));
		status := 'SUCCESSFUL';
END;