CREATE OR REPLACE PROCEDURE "USER_INFO"(ID IN NUMBER, STATUS OUT VARCHAR2,DETAILS OUT SYS_REFCURSOR,FOLLOWING OUT SYS_REFCURSOR, DIETARY OUT SYS_REFCURSOR,FAV_RECIPE OUT SYS_REFCURSOR,CREATED_RECIPE OUT SYS_REFCURSOR,MP_CR OUT SYS_REFCURSOR) AS
BEGIN
OPEN DETAILS FOR
SELECT  U.USER_ID,U.FIRST_NAME,U.LAST_NAME,U.EMAIL_ADDRESS,U.PROFILE_PICTURE,TO_CHAR(U.REGISTRATION_DATE,'DD/MON/YY') AS REGISTRATION_DATE
FROM USERS U
WHERE U.USER_ID = ID;

OPEN FOLLOWING FOR 
SELECT F.FOLLOWING_ID AS FOLLOWING_ID ,(SELECT (FIRST_NAME||' '||LAST_NAME) FROM USERS WHERE USER_ID = F.FOLLOWING_ID) AS NAME, (SELECT EMAIL_ADDRESS FROM USERS WHERE USER_ID = F.FOLLOWING_ID) AS EMAIL_ADDRESS,(SELECT PROFILE_PICTURE FROM USERS WHERE USER_ID = F.USER_ID) AS PROFILE_PICTURE
from USERS u LEFT JOIN FOLLOW F ON U.USER_ID = F.USER_ID
WHERE U.USER_ID = ID;

OPEN DIETARY FOR
SELECT  D.DIETARY_ID AS DIETARY_ID,D.RESTRICTION AS RESTRICTION
FROM  USERS U 
LEFT JOIN USER_DIETARY_RESTRICTIONS UD ON UD.USER_ID = U.USER_ID
LEFT JOIN DIETARY_RESTRICTIONS D ON D.DIETARY_ID = UD.DIETARY_ID
WHERE U.USER_ID = ID;

OPEN FAV_RECIPE FOR
SELECT R.RECIPE_ID AS RECIPE_ID,R.TITLE as RECIPE_TITLE,(SELECT (FIRST_NAME||' '||LAST_NAME) FROM USERS WHERE USER_ID = R.USER_ID)  AS PUBLISHER_NAME,(SELECT USER_ID FROM USERS WHERE USER_ID = R.USER_ID) AS PUBLISHER_ID,TO_CHAR(R.CREATION_DATE,'DD/MON/YY') CREATION_DATE , R.COOKING_INSTRUCTION ,AVERAGE_RATING(R.RECIPE_ID) as RATING,(SELECT IMAGE FROM MEDIA WHERE RECIPE_ID = R.RECIPE_ID)AS IMAGE
FROM  USERS U LEFT JOIN FAVOURITE F ON U.USER_ID = F.USER_ID
LEFT JOIN RECIPES R ON R.RECIPE_ID = F.RECIPE_ID 
WHERE U.USER_ID = ID;

OPEN CREATED_RECIPE FOR 
	SELECT R.RECIPE_ID, R.TITLE,TO_CHAR(R.CREATION_DATE,'DD/MON/YY') CREATION_DATE , R.COOKING_INSTRUCTION ,AVERAGE_RATING(R.RECIPE_ID) as RATING,(SELECT IMAGE FROM MEDIA WHERE RECIPE_ID = R.RECIPE_ID)AS IMAGE
FROM USERS U LEFT JOIN RECIPES R ON R.USER_ID = U.USER_ID
WHERE U.USER_ID = ID;

OPEN MP_CR FOR 
SELECT *
FROM MEAL_PLANS
WHERE USER_ID = ID;

STATUS := 'SUCCESSFUL';
EXCEPTION
	WHEN NO_DATA_FOUND THEN
	STATUS := 'NO DATA FOUND';
	WHEN OTHERS THEN
	STATUS := 'UNKNOWN ERROR';
END;